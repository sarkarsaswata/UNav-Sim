<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Welcome to MavLinkCom | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Welcome to MavLinkCom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/mavlinkcom.html" />
<meta property="og:url" content="http://localhost:4000/docs/mavlinkcom.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Welcome to MavLinkCom" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/mavlinkcom.html","headline":"Welcome to MavLinkCom","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="welcome-to-mavlinkcom">Welcome to MavLinkCom</h1>

<p>MavLinkCom is a cross-platform C++ library that helps connect to and communicate with <a href="https://github.com/mavlink/mavlink">MavLink</a> based vehicles.
Specifically this library is designed to work well with <a href="https://github.com/PX4/Firmware">PX4</a> based drones.</p>

<h2 id="design">Design</h2>

<p>You can view and edit the <a href="mavlinkcom_design/Design.dgml">Design.dgml</a> diagram in Visual Studio.<br />
<img src="mavlinkcom_design/images/overview.png" alt="Overview" /></p>

<p>The following are the most important classes in this library.</p>

<h3 id="mavlinknode">MavLinkNode</h3>

<p>This is the base class for all MavLinkNodes (subclasses include MavLinkVehicle, MavLinkVideoClient and MavLinkVideoServer).
The node connects to your mavlink enabled vehicle via a MavLinkConnection and provides methods for sending MavLinkMessages and MavLinkCommands
and for subscribing to receive messages.  This base class also stores the local system id and component id your app wants to use to identify
itself to your remote vehicle.  You can also call startHeartbeat to send regular heartbeat messages to keep the connection alive.</p>

<h3 id="mavlinkmessage">MavLinkMessage</h3>

<p>This is the encoded MavLinkMessage.  For those who have used the mavlink.h C API, this is similar to mavlink_message_t.  You do
not create these manually, they are encoded from a strongly typed MavLinkMessageBase subclass.</p>

<h3 id="strongly-typed-message-and-command-classes">Strongly typed message and command classes</h3>

<p>The MavLinkComGenerator parses the mavlink common.xml message definitions and generates all the MavLink* MavLinkMessageBase subclasses
as well as a bunch of handy mavlink enums and a bunch of strongly typed MavLinkCommand subclasses.</p>

<h3 id="mavlinkmessagebase">MavLinkMessageBase</h3>

<p>This is the base class for a set of strongly typed message classes that are code generated by the MavLinkComGenerator project.
This replaces the C messages defined in the mavlink C API and provides a slightly more object oriented way to send and receive messages
via sendMessage on MavLinkNode.  These classes have encode/decode methods that convert to and from the MavLinkMessage class.</p>

<h3 id="mavlinkcommand">MavLinkCommand</h3>

<p>This is the base class for a set of strongly typed command classes that are code generated by the MavLinkComGenerator project.
This replaces the C definitions defined in the mavlink C API and provides a more object oriented way to send commands via the sendCommand
method on MavLinkNode.  The MavLinkNode takes care of turning these into the underlying mavlink COMMAND_LONG message.</p>

<h3 id="mavlinkconnection">MavLinkConnection</h3>

<p>This class provides static helper methods for creating connections to remote MavLink nodes, over serial ports, as well as UDP, or TCP sockets.
This class provides a way to subscribe to receive messages from that node in a pub/sub way so you can have multiple subscribers on the
same connection.  MavLinkVehicle uses this to track various messages that define the overall vehicle state.</p>

<h3 id="mavlinkvehicle">MavLinkVehicle</h3>

<p>MavLinkVehicle is a MavLinkNode that tracks various messages that define the overall vehicle state and provides a VehicleState struct
containing a snapshot of that state, including home position, current orientation, local position, global position, and so on.
This class also provides a bunch of helper methods that wrap commonly used commands providing simple method calls to do things like
arm, disarm, takeoff, land, go to a local coordinate, and fly under offbaord control either by position or velocity control.</p>

<h3 id="mavlinktcpserver">MavLinkTcpServer</h3>

<p>This helper class provides a way to setup a “server” that accepts MavLinkConnections from remote nodes.  You can use this class
to get a connection that you can then give to MavLinkVideoServer to serve images over MavLink.</p>

<h3 id="mavlinkftpclient">MavLinkFtpClient</h3>

<p>This helper class takes a given MavLinkConnection and provides FTP client support for the MAVLINK_MSG_ID_FILE_TRANSFER_PROTOCOL
for vehicles that support the FTP capability.  This class provides simple methods to list directory contents, and the get and put
files.</p>

<h3 id="mavlinkvideoclient">MavLinkVideoClient</h3>

<p>This helper class takes a given MavLinkConnection and provides helper methods for requesting video from remote node and 
packaging up the MAVLINK_MSG_ID_DATA_TRANSMISSION_HANDSHAKE and MAVLINK_MSG_ID_ENCAPSULATED_DATA messages into simple to use
MavLinkVideoFrames.</p>

<h3 id="mavlinkvideoserver">MavLinkVideoServer</h3>

<p>This helper class takes a given MavLinkConnection and provides the server side of the MavLinkVideoClient protocol, including helper methods 
for notifying when there is a video request to process (hasVideoRequest) and a method to send video frames (sendFrame) which 
will generate the right MAVLINK_MSG_ID_DATA_TRANSMISSION_HANDSHAKE and MAVLINK_MSG_ID_ENCAPSULATED_DATA sequence.</p>

<h2 id="examples">Examples</h2>

<p>The following code from the UnitTest project shows how to connect to a <a href="http://www.pixhawk.org/">Pixhawk</a> flight controller over USB serial port, 
then wait for the first heartbeat message to be received:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">MavLinkConnection</span><span class="o">::</span><span class="n">connectSerial</span><span class="p">(</span><span class="s">"drone"</span><span class="p">,</span> <span class="s">"/dev/ttyACM0"</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="s">"sh /etc/init.d/rc.usb</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="n">MavLinkHeartbeat</span> <span class="n">heartbeat</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">waitForHeartbeat</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">heartbeat</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Received no heartbeat from PX4 after 10 seconds"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The following code connects to serial port, and then forwards all messages to and from QGroundControl to that drone using another connection
that is joined to the drone stream.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">droneConnection</span> <span class="o">=</span> <span class="n">MavLinkConnection</span><span class="o">::</span><span class="n">connectSerial</span><span class="p">(</span><span class="s">"drone"</span><span class="p">,</span> <span class="s">"/dev/ttyACM0"</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="s">"sh /etc/init.d/rc.usb</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">proxyConnection</span> <span class="o">=</span> <span class="n">MavLinkConnection</span><span class="o">::</span><span class="n">connectRemoteUdp</span><span class="p">(</span><span class="s">"qgc"</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">14550</span><span class="p">);</span>
<span class="n">droneConnection</span><span class="o">-&gt;</span><span class="n">join</span><span class="p">(</span><span class="n">proxyConnection</span><span class="p">);</span>
</code></pre></div></div>
<p>The following code then takes that connection and turns on heartBeats and starts tracking vehicle information using local
system id 166 and component id 1.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">vehicle</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MavLinkVehicle</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">166</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">connect</span><span class="p">(</span><span class="n">connection</span><span class="p">);</span>
<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">startHeartbeat</span><span class="p">();</span>

<span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>

<span class="n">VehicleState</span> <span class="n">state</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getVehicleState</span><span class="p">();</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Home position is %s, %f,%f,%f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">home</span><span class="p">.</span><span class="n">is_set</span> <span class="o">?</span> <span class="s">"set"</span> <span class="o">:</span> <span class="s">"not set"</span><span class="p">,</span> 
	<span class="n">state</span><span class="p">.</span><span class="n">home</span><span class="p">.</span><span class="n">global_pos</span><span class="p">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">home</span><span class="p">.</span><span class="n">global_pos</span><span class="p">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">home</span><span class="p">.</span><span class="n">global_pos</span><span class="p">.</span><span class="n">alt</span><span class="p">);</span>
</code></pre></div></div>
<p>The following code uses the vehicle object to arm the drone and take off and wait for the takeoff altitude to be reached:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">rc</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">armDisarm</span><span class="p">(</span><span class="nb">true</span><span class="p">).</span><span class="n">wait</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rc</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"arm command failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">takeoff</span><span class="p">(</span><span class="n">targetAlt</span><span class="p">).</span><span class="n">wait</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rc</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"takeoff command failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">version</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getVehicleStateVersion</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">newVersion</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getVehicleStateVersion</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">version</span> <span class="o">!=</span> <span class="n">newVersion</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">VehicleState</span> <span class="n">state</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getVehicleState</span><span class="p">();</span>
		<span class="kt">float</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">local_est</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">alt</span> <span class="o">&gt;=</span> <span class="n">targetAlt</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&amp;&amp;</span> <span class="n">alt</span> <span class="o">&lt;=</span> <span class="n">targetAlt</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span>
		<span class="p">{</span>			
			<span class="n">reached</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"Target altitude reached</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>The following code uses offboard control to make the drone fly in a circle with camera pointed at the center.
Here we use the subscribe method to check each new local position message to indicate so we can compute the new 
velocity vector as soon as that new position is received.  We request a high rate for those messages using 
setMessageInterval to ensure smooth circular orbit.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">setMessageInterval</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">MavLinkMessageIds</span><span class="o">::</span><span class="n">MAVLINK_MSG_ID_LOCAL_POSITION_NED</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">requestControl</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">subscribe</span><span class="p">(</span>
	<span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MavLinkConnection</span><span class="o">&gt;</span> <span class="n">connection</span><span class="p">,</span> <span class="k">const</span> <span class="n">MavLinkMessage</span><span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">msgid</span> <span class="o">==</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">MavLinkMessageIds</span><span class="o">::</span><span class="n">MAVLINK_MSG_ID_LOCAL_POSITION_NED</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="c1">// convert generic msg to strongly typed message.</span>
			<span class="n">MavLinkLocalPositionNed</span> <span class="n">localPos</span><span class="p">;</span>
			<span class="n">localPos</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span> 
			<span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">localPos</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">localPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">angle</span> <span class="o">+=</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">tangent</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">M_PI_2</span><span class="p">;</span>
			<span class="kt">double</span> <span class="n">newvx</span> <span class="o">=</span> <span class="n">orbitSpeed</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">tangent</span><span class="p">);</span>
			<span class="kt">double</span> <span class="n">newvy</span> <span class="o">=</span> <span class="n">orbitSpeed</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">tangent</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">heading</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">;</span>
			<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">moveByLocalVelocityWithAltHold</span><span class="p">(</span><span class="n">newvx</span><span class="p">,</span> <span class="n">newvy</span><span class="p">,</span> <span class="n">altitude</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">heading</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
</code></pre></div></div>
<p>The following code stops flying the drone in offboard mode and tells the drone to loiter at its current location.
This version of the code shows how to use the AsyncResult without blocking on a wait call.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">releaseControl</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">loiter</span><span class="p">().</span><span class="n">then</span><span class="p">([</span><span class="o">=</span><span class="p">](</span><span class="kt">bool</span> <span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"loiter command %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">rc</span> <span class="o">?</span> <span class="s">"succeeded"</span> <span class="o">:</span> <span class="s">"failed"</span><span class="p">);</span>
	<span class="p">}</span>
</code></pre></div></div>

<p>The following code gets all configurable parameters from the drone and prints them:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">auto</span> <span class="n">list</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">getParamList</span><span class="p">();</span>
	<span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">list</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
	<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">list</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">;</span> <span class="n">iter</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">count</span><span class="o">++</span><span class="p">;</span>
		<span class="n">MavLinkParameter</span> <span class="n">p</span> <span class="o">=</span> <span class="o">*</span><span class="n">iter</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MAV_PARAM_TYPE_REAL32</span> <span class="o">||</span> <span class="n">p</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MAV_PARAM_TYPE_REAL64</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%s=%f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%s=%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">value</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
</code></pre></div></div>
<p>The following code sets a parameter on the Pixhawk to disable the USB safety check (this is handy if you are controlling
the Pixhawk over USB using another onboard computer that is part of the drone itself).  You should NOT do this if you
are connecting your PC or laptop to the drone over USB.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">MavLinkParameter</span>  <span class="n">p</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CBRK_USB_CHK"</span><span class="p">;</span>
    <span class="n">p</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">197848</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">setParameter</span><span class="p">(</span><span class="n">p</span><span class="p">).</span><span class="n">wait</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="o">&amp;</span><span class="n">rc</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Setting the CBRK_USB_CHK failed"</span><span class="p">);</span>
	<span class="p">}</span>
</code></pre></div></div>

<p>MavLinkVehicle actually has a helper method for this called allowFlightControlOverUsb, so now you know how it is implemented :-)</p>

<h2 id="advanced-connections">Advanced Connections</h2>

<p>You can wire up different configurations of mavlink pipelines using the MavLinkConnection class “join” method as shown below.</p>

<p>Example 1, we connect to PX4 over serial, and proxy those messages through to QGroundControl and the LogViewer who are listening on remote ports.</p>

<p><img src="mavlinkcom_design/images/example1.png" alt="Serial to QGC" /></p>

<p>Example 2: simulation can talk to jMavSim and jMavSim connects to PX4.  jMavSim can also manage multiple connections, so it can talk to unreal simulator. 
Another MavLinkConnection can be joined to proxy connections that jMavSim doesn’t support, like the LogViewer or a remote camera node.</p>

<p><img src="mavlinkcom_design/images/example2.png" alt="Serial to QGC" /></p>

<p>Example 3: we use MavLinkConnection to connect to PX4 over serial, then join additional connections for all our remote nodes including jMavSim.</p>

<p><img src="mavlinkcom_design/images/example3.png" alt="Serial to QGC" /></p>

<p>Example 4: We can also do distributed systems to control the drone remotely:</p>

<p><img src="mavlinkcom_design/images/example4.png" alt="Serial to QGC" /></p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
