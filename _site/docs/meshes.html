<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How to Access Meshes in AIRSIM | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="How to Access Meshes in AIRSIM" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/meshes.html" />
<meta property="og:url" content="http://localhost:4000/docs/meshes.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to Access Meshes in AIRSIM" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/meshes.html","headline":"How to Access Meshes in AIRSIM","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="how-to-access-meshes-in-airsim">How to Access Meshes in AIRSIM</h1>

<p>AirSim supports the ability to access the static meshes that make up the scene.</p>

<h2 id="mesh-structure">Mesh structure</h2>
<p>Each mesh is represented with the below struct.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">MeshPositionVertexBuffersResponse</span> <span class="p">{</span>

	<span class="n">Vector3r</span> <span class="n">position</span><span class="p">;</span>
	<span class="n">Quaternionr</span> <span class="n">orientation</span><span class="p">;</span>

	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">vertices</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span> <span class="n">indices</span><span class="p">;</span>
	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<ul>
  <li>The position and orientation are in the Unreal coordinate system.</li>
  <li>The mesh itself is a triangular mesh represented by the vertices and the indices.
    <ul>
      <li>The triangular mesh type is typically called a <a href="https://en.wikipedia.org/wiki/Polygon_mesh#Face-vertex_meshes">Face-Vertex</a> Mesh. This means every triplet of indices hold the indexes of the vertices that make up the triangle/face.</li>
      <li>The x,y,z coordinates of the vertices are all stored in a single vector. This means the vertices vector is Nx3 where N is number of vertices.</li>
      <li>The position of the vertices are the global positions in the Unreal coordinate system. This means they have already been transformed by the position and orientation.</li>
    </ul>
  </li>
</ul>

<h2 id="how-to-use">How to use</h2>
<p>The API to get the meshes in the scene is quite simple. However, one should note that the function call is very expensive and should
 very rarely be called. In general this is ok because this function only accesses the static meshes which for most applications are
 not changing during the duration of your program.</p>

<p>Note that you will have to use a 3rdparty library or your own custom code to actually interact with the received meshes. Below I utilize the
Python bindings of <a href="https://github.com/libigl/libigl">libigl</a> to visualize the received meshes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">airsim</span>

<span class="n">AIRSIM_HOST_IP</span><span class="o">=</span><span class="s">'127.0.0.1'</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">airsim</span><span class="p">.</span><span class="n">VehicleClient</span><span class="p">(</span><span class="n">ip</span><span class="o">=</span><span class="n">AIRSIM_HOST_IP</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">confirmConnection</span><span class="p">()</span>

<span class="c1"># List of returned meshes are received via this function
</span><span class="n">meshes</span><span class="o">=</span><span class="n">client</span><span class="p">.</span><span class="n">simGetMeshPositionVertexBuffers</span><span class="p">()</span>


<span class="n">index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
    <span class="c1"># Finds one of the cube meshes in the Blocks environment
</span>    <span class="k">if</span> <span class="s">'cube'</span> <span class="ow">in</span> <span class="n">m</span><span class="p">.</span><span class="n">name</span><span class="p">:</span>

        <span class="c1"># Code from here on relies on libigl. Libigl uses pybind11 to wrap C++ code. So here the built pyigl.so
</span>        <span class="c1"># library is in the same directory as this example code.
</span>        <span class="c1"># This is here as code for your own mesh library should require something similar
</span>        <span class="kn">from</span> <span class="nn">pyigl</span> <span class="kn">import</span> <span class="o">*</span>
        <span class="kn">from</span> <span class="nn">iglhelpers</span> <span class="kn">import</span> <span class="o">*</span>

        <span class="c1"># Convert the lists to numpy arrays
</span>        <span class="n">vertex_list</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">vertices</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">indices</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">indices</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">uint32</span><span class="p">)</span>

        <span class="n">num_vertices</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vertex_list</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">num_indices</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="c1"># Libigl requires the shape to be Nx3 where N is number of vertices or indices
</span>        <span class="c1"># It also requires the actual type to be double(float64) for vertices and int64 for the triangles/indices
</span>        <span class="n">vertices_reshaped</span><span class="o">=</span><span class="n">vertex_list</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_vertices</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">indices_reshaped</span><span class="o">=</span><span class="n">indices</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">num_indices</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">vertices_reshaped</span><span class="o">=</span><span class="n">vertices_reshaped</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">indices_reshaped</span><span class="o">=</span><span class="n">indices_reshaped</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="c1"># Libigl function to convert to internal Eigen format
</span>        <span class="n">v_eig</span><span class="o">=</span><span class="n">p2e</span><span class="p">(</span><span class="n">vertices_reshaped</span><span class="p">)</span>
        <span class="n">i_eig</span><span class="o">=</span><span class="n">p2e</span><span class="p">(</span><span class="n">indices_reshaped</span><span class="p">)</span>

        <span class="c1"># View the mesh
</span>        <span class="n">viewer</span> <span class="o">=</span> <span class="n">igl</span><span class="p">.</span><span class="n">glfw</span><span class="p">.</span><span class="n">Viewer</span><span class="p">()</span>
        <span class="n">viewer</span><span class="p">.</span><span class="n">data</span><span class="p">().</span><span class="n">set_mesh</span><span class="p">(</span><span class="n">v_eig</span><span class="p">,</span><span class="n">i_eig</span><span class="p">)</span>
        <span class="n">viewer</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
        <span class="k">break</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
