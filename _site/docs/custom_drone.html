<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>AirLib on a Real Drone | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="AirLib on a Real Drone" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/custom_drone.html" />
<meta property="og:url" content="http://localhost:4000/docs/custom_drone.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AirLib on a Real Drone" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/custom_drone.html","headline":"AirLib on a Real Drone","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="airlib-on-a-real-drone">AirLib on a Real Drone</h1>

<p>The AirLib library can be compiled and deployed on the companion computer on a real drone. For our testing, we mounted a Gigabyte Brix BXi7-5500 ultra compact PC on the drone connected to the Pixhawk flight controller over USB. The Gigabyte PC is running Ubuntu, so we are able to SSH into it over Wi-Fi:</p>

<p><img src="images/Flamewheel.png" alt="Flamewheel" /></p>

<p>Once connected you can run MavLinkTest with this command line:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. 
</code></pre></div></div>
<p>And this will produce a log file of the flight which can then be used for <a href="playback.md">playback in the simulator</a>.</p>

<p>You can also add <code class="language-plaintext highlighter-rouge">-proxy:192.168.1.100:14550</code> to connect MavLinkTest to a remote computer where you can run QGroundControl or our 
<a href="log_viewer.md">PX4 Log Viewer</a> which is another handy way to see what is going on with your drone.</p>

<p>MavLinkTest then has some simple commands for testing your drone, here’s a simple example of some commands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arm
takeoff 5
orbit 10 2
</code></pre></div></div>

<p>This will arm the drone, takeoff of 5 meters, then do an orbit pattern radius 10 meters, at 2 m/s.
Type ‘?’ to find all available commands.</p>

<p><strong>Note:</strong> Some commands (for example, <code class="language-plaintext highlighter-rouge">orbit</code>) are named differently and have different syntax in MavLinkTest and DroneShell (for example, <code class="language-plaintext highlighter-rouge">circlebypath -radius 10 -velocity 21</code>).</p>

<p>When you land the drone you can stop MavLinkTest and copy the *.mavlink log file that was generated.</p>

<h1 id="droneserver-and-droneshell">DroneServer and DroneShell</h1>

<p>Once you are happy that the MavLinkTest is working, you can also run DroneServer and DroneShell as follows. First, run MavLinkTest with a local proxy to send everything to DroneServer:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. -proxy:127.0.0.1:14560
</code></pre></div></div>
<p>Change ~/Documents/AirSim/settings.json to say “serial”:false, because we want DroneServer to look for this UDP connection.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DroneServer 0
</code></pre></div></div>

<p>Lastly, you can now connect DroneShell to this instance of DroneServer and use the DroneShell commands to fly your drone:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DroneShell
==||=&gt;
        Welcome to DroneShell 1.0.
        Type ? for help.
        Microsoft Research (c) 2016.

Waiting for drone to report a valid GPS location...
==||=&gt; requestcontrol
==||=&gt; arm
==||=&gt; takeoff
==||=&gt; circlebypath -radius 10 -velocity 2
</code></pre></div></div>

<h2 id="px4-specific-tools">PX4 Specific Tools</h2>
<p>You can run the MavlinkCom library and MavLinkTest app to test the connection
between your companion computer and flight controller.</p>

<h2 id="how-does-this-work">How Does This Work?</h2>
<p>AirSim uses MavLinkCom component developed by @lovettchris. The MavLinkCom has a proxy architecture where you can open a connection to PX4 either using serial or UDP and then other components share this connection. When PX4 sends MavLink message, all components receive that message. If any component sends a message then it’s received by PX4 only. This allows you to connect any number of components to PX4 <a href="https://github.com/microsoft/AirSim/blob/main/AirLib/include/vehicles/multirotor/firmwares/mavlink/MavLinkMultirotorApi.hpp#L600">This code</a> opens a connection for LogViewer and QGC. You can add something more if you like.</p>

<p>If you want to use QGC + AirSim together than you will need QGC to let own the serial port. QGC opens up TCP connection that acts as a proxy so any other component can connect to QGC and send MavLinkMessage to QGC and then QGC forwards that message to PX4. So you tell AirSim to connect to QGC and let QGC own serial port.</p>

<p>For companion board, the way we did it earlier was to have Gigabyte Brix on the drone. This x86 full-fledged computer that will connect to PX4 through USB. We had Ubuntu on Brix and ran <a href="https://github.com/Microsoft/AirSim/tree/main/DroneServer">DroneServer</a>. The DroneServer created an API endpoint that we can talk to via C++ client code (or Python code) and it translated API calls to MavLink messages. That way you can write your code against the same API, test it in the simulator and then run the same code on an actual vehicle. So the companion computer has DroneServer running along with client code.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
