<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Modifying Recording Data | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Modifying Recording Data" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/modify_recording_data.html" />
<meta property="og:url" content="http://localhost:4000/docs/modify_recording_data.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Modifying Recording Data" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/modify_recording_data.html","headline":"Modifying Recording Data","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="modifying-recording-data">Modifying Recording Data</h1>

<p>AirSim has a <a href="settings.md#recording">Recording feature</a> to easily collect data and images. The <a href="apis.md#recording-apis">Recording APIs</a> also allows starting and stopping the recording using API.</p>

<p>However, the data recorded by default might not be sufficient for your use cases, and it might be preferable to record additional data such as IMU, GPS sensors, Rotor speed for copters, etc. You can use the existing Python and C++ APIs to get the information and store it as required, especially for Lidar. Another option for adding small fields such as GPS or internal data such as Unreal position or something else is possible through modifying the recording methods inside AirSim. This page describes the specific methods which you might need to change.</p>

<p>The recorded data is written in a <code class="language-plaintext highlighter-rouge">airsim_rec.txt</code> file in a tab-separated format, with images in an <code class="language-plaintext highlighter-rouge">images/</code> folder. The entire folder is by default present in the <code class="language-plaintext highlighter-rouge">Documents</code> folder (or specified in settings) with the timestamp of when the recording started in <code class="language-plaintext highlighter-rouge">%Y-%M-%D-%H-%M-%S</code> format.</p>

<p>Car vehicle records the following fields -</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VehicleName TimeStamp   POS_X   POS_Y   POS_Z   Q_W Q_X Q_Y Q_Z Throttle    Steering    Brake   Gear    Handbrake   RPM Speed   ImageFile
</code></pre></div></div>

<p>For Multirotor -</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VehicleName TimeStamp   POS_X   POS_Y   POS_Z   Q_W Q_X Q_Y Q_Z ImageFile
</code></pre></div></div>

<h2 id="code-changes">Code Changes</h2>

<p>Note that this requires building and using AirSim from source. You can compile a binary yourself after modifying if needed.</p>

<p>The primary method which fills the data to be stored is <a href="https://github.com/microsoft/AirSim/blob/880c5541fd4824ee2cd9bb82ca5f611eb1ab236a/Unreal/Plugins/AirSim/Source/PawnSimApi.cpp#L544"><code class="language-plaintext highlighter-rouge">PawnSimApi::getRecordFileLine</code></a>, itâ€™s the base method for all the vehicles, and Car overrides it to log additional data, as can be seen in <a href="https://github.com/microsoft/AirSim/blob/880c5541fd4824ee2cd9bb82ca5f611eb1ab236a/Unreal/Plugins/AirSim/Source/Vehicles/Car/CarPawnSimApi.cpp#L34"><code class="language-plaintext highlighter-rouge">CarPawnSimApi::getRecordFileLine</code></a>.</p>

<p>To record additional data for multirotor, you can add a similar method in <a href="https://github.com/microsoft/AirSim/tree/main/Unreal/Plugins/AirSim/Source/Vehicles/Multirotor">MultirotorPawnSimApi.cpp/h</a> files which overrides the base class implementation and append other data. The currently logged data can also be modified and removed as needed.</p>

<p>E.g. recording GPS, IMU and Barometer data also for multirotor -</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MultirotorPawnSimApi.cpp</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">MultirotorPawnSimApi</span><span class="o">::</span><span class="n">getRecordFileLine</span><span class="p">(</span><span class="kt">bool</span> <span class="n">is_header_line</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">common_line</span> <span class="o">=</span> <span class="n">PawnSimApi</span><span class="o">::</span><span class="n">getRecordFileLine</span><span class="p">(</span><span class="n">is_header_line</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_header_line</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">common_line</span> <span class="o">+</span>
               <span class="s">"Latitude</span><span class="se">\t</span><span class="s">Longitude</span><span class="se">\t</span><span class="s">Altitude</span><span class="se">\t</span><span class="s">Pressure</span><span class="se">\t</span><span class="s">AccX</span><span class="se">\t</span><span class="s">AccY</span><span class="se">\t</span><span class="s">AccZ</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">state</span> <span class="o">=</span> <span class="n">vehicle_api_</span><span class="o">-&gt;</span><span class="n">getMultirotorState</span><span class="p">();</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">bar_data</span> <span class="o">=</span> <span class="n">vehicle_api_</span><span class="o">-&gt;</span><span class="n">getBarometerData</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">imu_data</span> <span class="o">=</span> <span class="n">vehicle_api_</span><span class="o">-&gt;</span><span class="n">getImuData</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span> <span class="n">ss</span><span class="p">;</span>
    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">common_line</span><span class="p">;</span>
    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">state</span><span class="p">.</span><span class="n">gps_location</span><span class="p">.</span><span class="n">latitude</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">state</span><span class="p">.</span><span class="n">gps_location</span><span class="p">.</span><span class="n">longitude</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span>
       <span class="o">&lt;&lt;</span> <span class="n">state</span><span class="p">.</span><span class="n">gps_location</span><span class="p">.</span><span class="n">altitude</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>

    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">bar_data</span><span class="p">.</span><span class="n">pressure</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>

    <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">imu_data</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">imu_data</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">y</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span>
       <span class="o">&lt;&lt;</span> <span class="n">imu_data</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">z</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MultirotorPawnSimApi.h</span>
<span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getRecordFileLine</span><span class="p">(</span><span class="kt">bool</span> <span class="n">is_header_line</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
