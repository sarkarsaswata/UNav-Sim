<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>AirSim Development Environment on Azure | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="AirSim Development Environment on Azure" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/azure.html" />
<meta property="og:url" content="http://localhost:4000/docs/azure.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AirSim Development Environment on Azure" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/azure.html","headline":"AirSim Development Environment on Azure","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="airsim-development-environment-on-azure">AirSim Development Environment on Azure</h1>

<p>This document explains how to automate the creation of a development environment on Azure and code and debug a Python application connected to AirSim using Visual Studio Code</p>

<h2 id="automatically-deploy-your-azure-vm">Automatically Deploy Your Azure VM</h2>
<p>Click the blue button to start the Azure deployment (The template is pre-filled with the recommended virtual machine size for the use cases of the following two tutorials)</p>

<p><a href="https://aka.ms/AA8umgt" target="_blank">
    <img src="https://azuredeploy.net/deploybutton.png" />
</a><br />
<em>Note: the VM deployment and configuration process may take 20+ minutes to complete</em></p>

<h3 id="regarding-the-deployment-of-the-azure-vm">Regarding the deployment of the Azure VM</h3>
<ul>
  <li>
    <p>When using an Azure Trial account, the default vCPU quota is not enough to allocate the required VM to run AirSim. If thatâ€™s the case, you will see an error when trying to create the VM and will have to submit a request for Quota increase. <strong>Be sure to understand how and how much you are going to be charged for the use of the VM</strong></p>
  </li>
  <li>
    <p>To avoid charges for the Virtual Machine usage while not in use, remember to deallocate its resources from the <a href="https://portal.azure.com">Azure Portal</a> or use the following command from the Azure CLI:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az vm deallocate <span class="nt">--resource-group</span> MyResourceGroup <span class="nt">--name</span> MyVMName
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="code-and-debug-from-visual-studio-code-and-remote-ssh">Code and debug from Visual Studio Code and Remote SSH</h2>
<ul>
  <li>Install Visual Studio Code</li>
  <li>Install the <em>Remote - SSH</em> extension</li>
  <li>Press <code class="language-plaintext highlighter-rouge">F1</code> and run the <code class="language-plaintext highlighter-rouge">Remote - SSH: Connect to host...</code> command</li>
  <li>Add the recently create VM details. For instance, <code class="language-plaintext highlighter-rouge">AzureUser@11.22.33.44</code></li>
  <li>Run the <code class="language-plaintext highlighter-rouge">Remote - SSH: Connect to host...</code> command again, and now select the newly added connection.</li>
  <li>Once connected, click on the <code class="language-plaintext highlighter-rouge">Clone Repository</code> button in Visual Studio Code, and either clone this repository in the remote VM and open <em>just the <code class="language-plaintext highlighter-rouge">azure</code> folder</em>, or create a brand new repository, clone it and copy the contents of the <code class="language-plaintext highlighter-rouge">azure</code> folder from this repository in it. It is important to open that directory so Visual Studio Code can use the specific <code class="language-plaintext highlighter-rouge">.vscode</code> directory for the scenario and not the general AirSim <code class="language-plaintext highlighter-rouge">.vscode</code> directory. It contains the recommended extensions to install, the task to start AirSim remotely and the launch configuration for the Python application.</li>
  <li>Install all the recommended extensions</li>
  <li>Press <code class="language-plaintext highlighter-rouge">F1</code> and select the <code class="language-plaintext highlighter-rouge">Tasks: Run Task</code> option. Then, select the <code class="language-plaintext highlighter-rouge">Start AirSim</code> task from Visual Studio Code to execute the <code class="language-plaintext highlighter-rouge">start-airsim.ps1</code> script from Visual Studio Code.</li>
  <li>Open the <code class="language-plaintext highlighter-rouge">multirotor.py</code> file inside the <code class="language-plaintext highlighter-rouge">app</code> directory</li>
  <li>Start debugging with Python</li>
  <li>When finished, remember to stop an deallocate the Azure VM to avoid extra charges</li>
</ul>

<h2 id="code-and-debug-from-a-local-visual-studio-code-and-connect-to-airsim-via-forwarded-ports">Code and debug from a local Visual Studio Code and connect to AirSim via forwarded ports</h2>

<p><em>Note: this scenario, will be using two Visual Studio Code instances. 
The first one will be used as a bridge to forward ports via SSH to the Azure VM and execute remote processes, and the second one will 
be used for local Python development.
To be able to reach the VM from the local Python code, it is required to keep the <code class="language-plaintext highlighter-rouge">Remote - SSH</code> instance of Visual Studio Code opened, while working with the local Python environment on the second instance</em></p>

<ul>
  <li>Open the first Visual Studio Code instance</li>
  <li>Follow the steps in the previous section to connect via <code class="language-plaintext highlighter-rouge">Remote - SSH</code></li>
  <li>In the <em>Remote Explorer</em>, add the port <code class="language-plaintext highlighter-rouge">41451</code> as a forwarded port to localhost</li>
  <li>Either run the <code class="language-plaintext highlighter-rouge">Start AirSim</code> task on the Visual Studio Code with the remote session as explained in the previous scenario or manually start the AirSim binary in the VM</li>
  <li>Open a second Visual Studio Code instance, without disconnecting or closing the first one</li>
  <li>Either clone this repository locally and open <em>just the <code class="language-plaintext highlighter-rouge">azure</code> folder</em> in Visual Studio Code, or create a brand new repository, clone it and copy the contents of the <code class="language-plaintext highlighter-rouge">azure</code> folder from this repository in it.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">pip install -r requirements.txt</code> inside the <code class="language-plaintext highlighter-rouge">app</code> directory</li>
  <li>Open the <code class="language-plaintext highlighter-rouge">multirotor.py</code> file inside the <code class="language-plaintext highlighter-rouge">app</code> directory</li>
  <li>Start debugging with Python</li>
  <li>When finished, remember to stop an deallocate the Azure VM to avoid extra charges</li>
</ul>

<h2 id="running-with-docker">Running with Docker</h2>
<p>Once both the AirSim environment and the Python application are ready, you can package everything as a Docker image. The sample project inside the <code class="language-plaintext highlighter-rouge">azure</code> directory is already prepared to run a prebuilt AirSim binary and Python code using Docker.</p>

<p>This would be a perfect scenario when you want to run the simulation at scale. For instance, you could have several different configurations for the same simulation and execute them in a parallel, unattended way using a Docker image on Azure Container Services</p>

<p>Since AirSim requires access to the host GPU, it is required to use a Docker runtime that supports it. For more information about running AirSim in Docker, click <a href="docker_ubuntu.md">here</a>.</p>

<p>When using Azure Container Services to run this image, the only extra-requirement is to add GPU support to the Container Group where it will be deployed.</p>

<p>It can use either public docker images from DockerHub or images deployed to a private Azure Container Registry</p>

<h3 id="building-the-docker-image">Building the docker image</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> &lt;your-registry-url&gt;/&lt;your-image-name&gt; <span class="nt">-f</span> ./docker/Dockerfile .<span class="sb">`</span>
</code></pre></div></div>

<h2 id="using-a-different-airsim-binary">Using a different AirSim binary</h2>

<p>To use a different AirSim binary, first check the official documentation on <a href="build_windows.md">How to Build AirSim on Windows</a> and <a href="build_linux.md">How to Build AirSim on Linux</a> if you also want to run it with Docker</p>

<p>Once you have a zip file with the new AirSim environment (or prefer to use one from the <a href="https://github.com/microsoft/AirSim/releases">Official Releases</a>), you need to modify some of the scripts in the <code class="language-plaintext highlighter-rouge">azure</code> directory of the repository to point to the new environment:</p>
<ul>
  <li>In <a href="https://github.com/microsoft/AirSim/blob/main/azure/azure-env-creation/configure-vm.ps1"><code class="language-plaintext highlighter-rouge">azure/azure-env-creation/configure-vm.ps1</code></a>, modify all the parameters starting with <code class="language-plaintext highlighter-rouge">$airSimBinary</code> with the new values</li>
  <li>In <a href="https://github.com/microsoft/AirSim/blob/main/azure/start-airsim.ps1"><code class="language-plaintext highlighter-rouge">azure/start-airsim.ps1</code></a>, modify <code class="language-plaintext highlighter-rouge">$airSimExecutable</code> and <code class="language-plaintext highlighter-rouge">$airSimProcessName</code> with the new values</li>
</ul>

<p>If you are using the docker image, you also need a linux binary zip file and modify the following Docker-related files:</p>
<ul>
  <li>In <a href="https://github.com/microsoft/AirSim/blob/main/azure/docker/Dockerfile"><code class="language-plaintext highlighter-rouge">azure/docker/Dockerfile</code></a>, modify the <code class="language-plaintext highlighter-rouge">AIRSIM_BINARY_ZIP_URL</code> and <code class="language-plaintext highlighter-rouge">AIRSIM_BINARY_ZIP_FILENAME</code> ENV declarations with the new values</li>
  <li>In <a href="https://github.com/microsoft/AirSim/blob/main/azure/docker/docker-entrypoint.sh"><code class="language-plaintext highlighter-rouge">azure/docker/docker-entrypoint.sh</code></a>, modify <code class="language-plaintext highlighter-rouge">AIRSIM_EXECUTABLE</code> with the new value</li>
</ul>

<h2 id="maintaining-this-development-environment">Maintaining this development environment</h2>

<p>Several components of this development environment (ARM templates, initialization scripts and VSCode tasks) directly depend on the current directory structures file names and repository locations. When planning to modify/fork any of those, make sure to check every script and template to make any required adjustment.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
