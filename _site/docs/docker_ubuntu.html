<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>AirSim on Docker in Linux | UNav-Sim</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="AirSim on Docker in Linux" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<meta property="og:description" content="Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features." />
<link rel="canonical" href="http://localhost:4000/docs/docker_ubuntu.html" />
<meta property="og:url" content="http://localhost:4000/docs/docker_ubuntu.html" />
<meta property="og:site_name" content="UNav-Sim" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AirSim on Docker in Linux" />
<script type="application/ld+json">
{"url":"http://localhost:4000/docs/docker_ubuntu.html","headline":"AirSim on Docker in Linux","@type":"WebPage","description":"Intended as a documentation theme based on Jekyll for technical writers documenting software and other technical products, this theme has all the elements you would need to handle multiple products with both multi-level sidebar navigation, tags, and other documentation features.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">UNav-Sim</a></h1>
      

      <h1 id="airsim-on-docker-in-linux">AirSim on Docker in Linux</h1>
<p>We’ve two options for docker. You can either build an image for running <a href="#binaries">airsim linux binaries</a>, or for compiling Unreal Engine + AirSim <a href="#source">from source</a></p>

<h2 id="binaries">Binaries</h2>
<h4 id="requirements">Requirements:</h4>
<ul>
  <li>Install <a href="https://github.com/NVIDIA/nvidia-docker#quickstart">nvidia-docker2</a></li>
</ul>

<h4 id="build-the-docker-image">Build the docker image</h4>
<ul>
  <li>Below are the default arguments.
<code class="language-plaintext highlighter-rouge">--base_image</code>: This is image over which we’ll install airsim. We’ve tested on Ubuntu 18.04 with CUDA 10.0.
 You can specify any <a href="https://hub.docker.com/r/nvidia/cudagl/">NVIDIA cudagl</a> at your own risk.
 <code class="language-plaintext highlighter-rouge">--target_image</code> is the desired name of your docker image.
 Defaults to <code class="language-plaintext highlighter-rouge">airsim_binary</code> with same tag as the base image</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>Airsim/docker<span class="p">;</span>
<span class="nv">$ </span>python build_airsim_image.py <span class="se">\</span>
   <span class="nt">--base_image</span><span class="o">=</span>nvidia/cudagl:10.0-devel-ubuntu18.04 <span class="se">\</span>
   <span class="nt">--target_image</span><span class="o">=</span>airsim_binary:10.0-devel-ubuntu18.04
</code></pre></div></div>

<ul>
  <li>Verify you have an image by:
 <code class="language-plaintext highlighter-rouge">$ docker images | grep airsim</code></li>
</ul>

<h4 id="running-an-unreal-binary-inside-a-docker-container">Running an unreal binary inside a docker container</h4>
<ul>
  <li>Get <a href="https://github.com/Microsoft/AirSim/releases">a Linux binary</a> or package your own project in Ubuntu.
Let’s take the Blocks binary as an example.
You can download it by running</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nv">$ </span><span class="nb">cd </span>Airsim/docker<span class="p">;</span>
   <span class="nv">$ </span>./download_blocks_env_binary.sh
</code></pre></div></div>

<p>Modify it to fetch the specific binary required.</p>

<ul>
  <li>Running an unreal binary inside a docker container
 The syntax is:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nv">$ </span>./run_airsim_image_binary.sh DOCKER_IMAGE_NAME UNREAL_BINARY_SHELL_SCRIPT UNREAL_BINARY_ARGUMENTS <span class="nt">--</span> headless
</code></pre></div></div>

<p>For Blocks, you can do a <code class="language-plaintext highlighter-rouge">$ ./run_airsim_image_binary.sh airsim_binary:10.0-devel-ubuntu18.04 Blocks/Blocks.sh -windowed -ResX=1080 -ResY=720</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DOCKER_IMAGE_NAME</code>: Same as <code class="language-plaintext highlighter-rouge">target_image</code> parameter in previous step. By default, enter <code class="language-plaintext highlighter-rouge">airsim_binary:10.0-devel-ubuntu18.04</code></li>
  <li><code class="language-plaintext highlighter-rouge">UNREAL_BINARY_SHELL_SCRIPT</code>: for Blocks enviroment, it will be <code class="language-plaintext highlighter-rouge">Blocks/Blocks.sh</code></li>
  <li>
    <p><a href="https://docs.unrealengine.com/en-us/Programming/Basics/CommandLineArguments"><code class="language-plaintext highlighter-rouge">UNREAL_BINARY_ARGUMENTS</code></a>:
 For airsim, most relevant would be <code class="language-plaintext highlighter-rouge">-windowed</code>, <code class="language-plaintext highlighter-rouge">-ResX</code>, <code class="language-plaintext highlighter-rouge">-ResY</code>. Click on link to see all options.</p>
  </li>
  <li>Running in Headless mode:
  Suffix <code class="language-plaintext highlighter-rouge">-- headless</code> at the end:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./run_airsim_image_binary.sh Blocks/Blocks.sh <span class="nt">--</span> headless
</code></pre></div>    </div>
  </li>
  <li><a href="#specifying-settingsjson">Specifying a <code class="language-plaintext highlighter-rouge">settings.json</code></a></li>
</ul>

<h2 id="source">Source</h2>
<h4 id="requirements-1">Requirements:</h4>
<ul>
  <li>Install <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker">nvidia-docker2</a></li>
  <li>Install <a href="https://docs.adamrehn.com/ue4-docker/configuration/configuring-linux">ue4-docker</a></li>
</ul>

<h4 id="build-unreal-engine-inside-docker">Build Unreal Engine inside docker:</h4>
<ul>
  <li>
    <p>To get access to Unreal Engine’s source code, register on Epic Games’ website and link it to your github account, as explained in the <code class="language-plaintext highlighter-rouge">Required Steps</code> section <a href="https://docs.unrealengine.com/en-us/Platforms/Linux/BeginnerLinuxDeveloper/SettingUpAnUnrealWorkflow">here</a>.</p>

    <p>Note that you don’t need to do <code class="language-plaintext highlighter-rouge">Step 2: Downloading UE4 on Linux</code>!</p>
  </li>
  <li>Build unreal engine 4.19.2 docker image. We’re going to use CUDA 10.0 in our example.
  <code class="language-plaintext highlighter-rouge">$ ue4-docker build 4.19.2 --cuda=10.0 --no-full</code>
    <ul>
      <li>[optional] <code class="language-plaintext highlighter-rouge">$ ue4-docker clean</code> to free up some space. <a href="https://docs.adamrehn.com/ue4-docker/commands/clean">Details here</a></li>
      <li><code class="language-plaintext highlighter-rouge">ue4-docker</code> supports all CUDA version listed on NVIDIA’s cudagl dockerhub <a href="https://hub.docker.com/r/nvidia/cudagl/">here</a>.</li>
      <li>Please see <a href="https://docs.adamrehn.com/ue4-docker/building-images/advanced-build-options">this page</a> for advanced configurations using <code class="language-plaintext highlighter-rouge">ue4-docker</code></li>
    </ul>
  </li>
  <li>Disk space:
    <ul>
      <li>The unreal images and containers can take up a lot of space, especially if you try more than one version.</li>
      <li>Here’s a list of useful links to monitor space used by docker and clean up intermediate builds:
        <ul>
          <li><a href="https://docs.adamrehn.com/ue4-docker/read-these-first/large-container-images-primer">Large container images primer</a></li>
          <li><a href="https://docs.docker.com/engine/reference/commandline/system_df/"><code class="language-plaintext highlighter-rouge">docker system df</code></a></li>
          <li><a href="https://docs.docker.com/engine/reference/commandline/container_prune/"><code class="language-plaintext highlighter-rouge">docker container prune</code></a></li>
          <li><a href="https://docs.docker.com/engine/reference/commandline/image_prune/"><code class="language-plaintext highlighter-rouge">docker image prune</code></a></li>
          <li><a href="https://docs.docker.com/engine/reference/commandline/system_prune/"><code class="language-plaintext highlighter-rouge">docker system prune</code></a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="building-airsim-inside-ue4-docker-container">Building AirSim inside UE4 docker container:</h4>
<ul>
  <li>Build AirSim docker image (which lays over the unreal image we just built)
Below are the default arguments.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">--base_image</code>: This is image over which we’ll install airsim. We’ve tested on <code class="language-plaintext highlighter-rouge">adamrehn/ue4-engine:4.19.2-cudagl10.0</code>. See <a href="https://docs.adamrehn.com/ue4-docker/building-images/available-container-images">ue4-docker</a> for other versions.</li>
      <li><code class="language-plaintext highlighter-rouge">--target_image</code> is the desired name of your docker image.
 Defaults to <code class="language-plaintext highlighter-rouge">airsim_source</code> with same tag as the base image</li>
    </ul>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>Airsim/docker<span class="p">;</span>
<span class="nv">$ </span>python build_airsim_image.py <span class="se">\</span>
   <span class="nt">--source</span> <span class="se">\</span>
   <span class="nt">----base_image</span> adamrehn/ue4-engine:4.19.2-cudagl10.0 <span class="se">\</span>
   <span class="nt">--target_image</span><span class="o">=</span>airsim_source:4.19.2-cudagl10.0
</code></pre></div></div>

<h4 id="running-airsim-container">Running AirSim container</h4>
<ul>
  <li>Run the airsim source image we built by:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   ./run_airsim_image_source.sh airsim_source:4.19.2-cudagl10.0
</code></pre></div></div>

<p>Syntax is <code class="language-plaintext highlighter-rouge">./run_airsim_image_source.sh DOCKER_IMAGE_NAME -- headless</code>
   <code class="language-plaintext highlighter-rouge">-- headless</code>: suffix this to run in optional headless mode.</p>

<ul>
  <li>Inside the container, you can see <code class="language-plaintext highlighter-rouge">UnrealEngine</code> and <code class="language-plaintext highlighter-rouge">AirSim</code> under <code class="language-plaintext highlighter-rouge">/home/ue4</code>.</li>
  <li>Start unreal engine inside the container:
 <code class="language-plaintext highlighter-rouge">ue4@HOSTMACHINE:~$ /home/ue4/UnrealEngine/Engine/Binaries/Linux/UE4Editor</code></li>
  <li><a href="#specifying-settingsjson">Specifying an airsim settings.json</a></li>
  <li>Continue with <a href="build_linux.md#build-unreal-environment">AirSim’s Linux docs</a>.</li>
</ul>

<h4 id="misc-packaging-unreal-environments-in-airsim_source-containers">[Misc] Packaging Unreal Environments in <code class="language-plaintext highlighter-rouge">airsim_source</code> containers</h4>
<ul>
  <li>Let’s take the Blocks environment as an example.
  In the following script, specify the full path to your unreal uproject file by <code class="language-plaintext highlighter-rouge">project</code> and the directory where you want the binaries to be placed by <code class="language-plaintext highlighter-rouge">archivedirectory</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/home/ue4/UnrealEngine/Engine/Build/BatchFiles/RunUAT.sh BuildCookRun <span class="nt">-platform</span><span class="o">=</span>Linux <span class="nt">-clientconfig</span><span class="o">=</span>Shipping <span class="nt">-serverconfig</span><span class="o">=</span>Shipping <span class="nt">-noP4</span> <span class="nt">-cook</span> <span class="nt">-allmaps</span> <span class="nt">-build</span> <span class="nt">-stage</span> <span class="nt">-prereqs</span> <span class="nt">-pak</span> <span class="nt">-archive</span> <span class="se">\</span>
<span class="nt">-archivedirectory</span><span class="o">=</span>/home/ue4/Binaries/Blocks/ <span class="se">\</span>
<span class="nt">-project</span><span class="o">=</span>/home/ue4/AirSim/Unreal/Environments/Blocks/Blocks.uproject
</code></pre></div></div>

<p>This would create a Blocks binary in <code class="language-plaintext highlighter-rouge">/home/ue4/Binaries/Blocks/</code>.
You can test it by running <code class="language-plaintext highlighter-rouge">/home/ue4/Binaries/Blocks/LinuxNoEditor/Blocks.sh -windowed</code></p>

<h3 id="specifying-settingsjson">Specifying settings.json</h3>
<h4 id="airsim_binary-docker-image"><code class="language-plaintext highlighter-rouge">airsim_binary</code> docker image:</h4>
<ul>
  <li>We’re mapping the host machine’s <code class="language-plaintext highlighter-rouge">PATH/TO/Airsim/docker/settings.json</code> to the docker container’s <code class="language-plaintext highlighter-rouge">/home/airsim_user/Documents/AirSim/settings.json</code>.</li>
  <li>Hence, we can load any settings file by simply modifying <code class="language-plaintext highlighter-rouge">PATH_TO_YOUR/settings.json</code> by modifying the following snippets in <a href="https://github.com/Microsoft/AirSim/blob/main/docker/run_airsim_image_binary.sh"><code class="language-plaintext highlighter-rouge">run_airsim_image_binary.sh</code></a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-docker run <span class="nt">--runtime</span><span class="o">=</span>nvidia <span class="nt">-it</span> <span class="se">\</span>
      <span class="nt">-v</span> <span class="nv">$PATH_TO_YOUR</span>/settings.json:/home/airsim_user/Documents/AirSim/settings.json <span class="se">\</span>
      <span class="nt">-v</span> <span class="nv">$UNREAL_BINARY_PATH</span>:<span class="nv">$UNREAL_BINARY_PATH</span> <span class="se">\</span>
      <span class="nt">-e</span> <span class="nv">SDL_VIDEODRIVER</span><span class="o">=</span><span class="nv">$SDL_VIDEODRIVER_VALUE</span> <span class="se">\</span>
      <span class="nt">-e</span> <span class="nv">SDL_HINT_CUDA_DEVICE</span><span class="o">=</span><span class="s1">'0'</span> <span class="se">\</span>
      <span class="nt">--net</span><span class="o">=</span>host <span class="se">\</span>
      <span class="nt">--env</span><span class="o">=</span><span class="s2">"DISPLAY=</span><span class="nv">$DISPLAY</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--env</span><span class="o">=</span><span class="s2">"QT_X11_NO_MITSHM=1"</span> <span class="se">\</span>
      <span class="nt">--volume</span><span class="o">=</span><span class="s2">"/tmp/.X11-unix:/tmp/.X11-unix:rw"</span> <span class="se">\</span>
      <span class="nt">-env</span><span class="o">=</span><span class="s2">"XAUTHORITY=</span><span class="nv">$XAUTH</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--volume</span><span class="o">=</span><span class="s2">"</span><span class="nv">$XAUTH</span><span class="s2">:</span><span class="nv">$XAUTH</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--rm</span> <span class="se">\</span>
      <span class="nv">$DOCKER_IMAGE_NAME</span> <span class="se">\</span>
      /bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$UNREAL_BINARY_COMMAND</span><span class="s2">"</span>
</code></pre></div></div>

<p><strong>Note:</strong> Docker version &gt;=19.03 (check using <code class="language-plaintext highlighter-rouge">docker -v</code>), natively supports Nvidia GPUs, so run using <code class="language-plaintext highlighter-rouge">--gpus all</code> flag as given -</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--gpus</span> all <span class="nt">-it</span> <span class="se">\</span>
    ...
</code></pre></div></div>

<h4 id="airsim_source-docker-image"><code class="language-plaintext highlighter-rouge">airsim_source</code> docker image:</h4>

<ul>
  <li>We’re mapping the host machine’s <code class="language-plaintext highlighter-rouge">PATH/TO/Airsim/docker/settings.json</code> to the docker container’s <code class="language-plaintext highlighter-rouge">/home/airsim_user/Documents/AirSim/settings.json</code>.</li>
  <li>Hence, we can load any settings file by simply modifying <code class="language-plaintext highlighter-rouge">PATH_TO_YOUR/settings.json</code> by modifying the following snippets in <a href="https://github.com/Microsoft/AirSim/blob/main/docker/run_airsim_image_source.sh"><code class="language-plaintext highlighter-rouge">run_airsim_image_source.sh</code></a>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   nvidia-docker run <span class="nt">--runtime</span><span class="o">=</span>nvidia <span class="nt">-it</span> <span class="se">\</span>
      <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/settings.json:/home/airsim_user/Documents/AirSim/settings.json <span class="se">\</span>
      <span class="nt">-e</span> <span class="nv">SDL_VIDEODRIVER</span><span class="o">=</span><span class="nv">$SDL_VIDEODRIVER_VALUE</span> <span class="se">\</span>
      <span class="nt">-e</span> <span class="nv">SDL_HINT_CUDA_DEVICE</span><span class="o">=</span><span class="s1">'0'</span> <span class="se">\</span>
      <span class="nt">--net</span><span class="o">=</span>host <span class="se">\</span>
      <span class="nt">--env</span><span class="o">=</span><span class="s2">"DISPLAY=</span><span class="nv">$DISPLAY</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--env</span><span class="o">=</span><span class="s2">"QT_X11_NO_MITSHM=1"</span> <span class="se">\</span>
      <span class="nt">--volume</span><span class="o">=</span><span class="s2">"/tmp/.X11-unix:/tmp/.X11-unix:rw"</span> <span class="se">\</span>
      <span class="nt">-env</span><span class="o">=</span><span class="s2">"XAUTHORITY=</span><span class="nv">$XAUTH</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--volume</span><span class="o">=</span><span class="s2">"</span><span class="nv">$XAUTH</span><span class="s2">:</span><span class="nv">$XAUTH</span><span class="s2">"</span> <span class="se">\</span>
      <span class="nt">--rm</span> <span class="se">\</span>
   <span class="nv">$DOCKER_IMAGE_NAME</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
